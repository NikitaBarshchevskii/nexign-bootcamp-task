# Nexign Bootcamp Task

## Описание задания

Spring Boot микросервис, который генерирует CDR записи, сохраняет их в базу данных и предоставляет Rest-API для получения UDR отчетов и генерации сводного отчета с CDR записями по абоненту.

### Стек технологий
- Java 17
- Spring Boot 3.4.4
- Spring Data JPA
- Spring Web
- H2 Database
- Lombok

## Описание решения

Архитектура построена по слоям:

- `model` — содержит JPA-сущности `CDR` и `Subscriber`, отображающие таблицы базы данных.
- `repository` — включает `CDRRepository` и `SubscriberRepository`, реализующие интерфейсы Spring Data JPA для взаимодействия с H2.
- `service` — логика бизнес-обработки:
  - `UDRGeneratorService` отвечает за построение UDR по абоненту или всем абонентам.
  - `CDRReportService` формирует CDR-отчет в формате CSV по запросу.
- `controller` — REST-контроллеры `UDRController` и `CDRReportController` обрабатывают внешние запросы.
- `dto` — содержит `UDRResponse` с вложенным классом `CallInfo` для возврата UDR в нужном формате JSON.

Реализована фильтрация по месяцу и произвольному периоду. Все данные берутся только из базы данных H2, и генерируются при запуске приложения. CDR-записи сортируются в хронологическом порядке при выгрузке.

Формат CSV-отчета соответствует требованиям задания: данные разделены запятыми, файл содержит только записи по заданному абоненту и периоду, имя включает номер и UUID.

## Запуск приложения

```bash
./mvnw spring-boot:run
```
После запуска будет доступна H2 Console по адресу:

```
http://localhost:8080/h2-console
```

- JDBC URL: `jdbc:h2:mem:testdb`
- User: `sa`
- Password: (оставить пустым)


## Эндпоинты rest методов

### Получение UDR по абоненту

```bash
GET /api/udr/{msisdn}?month=YYYY-MM
```

- `msisdn` — номер абонента  
- `month` — необязательный параметр, месяц в формате YYYY-MM

### Получение UDR по всем абонентам

```bash
GET /api/udr?month=YYYY-MM
```

- `month` — обязательный параметр

### Генерация CDR-отчета в формате CSV

```bash
POST /api/report/{msisdn}?from=YYYY-MM-DDTHH:mm:ss&to=YYYY-MM-DDTHH:mm:ss
```

- `msisdn` — номер абонента  
- `from` — начало периода  
- `to` — конец периода

Файл сохраняется в директории `reports/`, название формируется как:

```
{msisdn}_{UUID}.csv
```

## Пример данных в файле CSV

```
01,79986543221,79123456789,2024-02-10T14:56:12,2024-02-10T14:58:20
02,79986667755,79986543221,2024-02-10T10:12:25,2024-02-10T10:12:57
```
